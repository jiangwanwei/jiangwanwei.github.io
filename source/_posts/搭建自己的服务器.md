---
title: 搭建自己的服务器（阿里云Linux）
comments: true
date: 2019-09-05 21:45:29
tags:
  - Linux
  - 阿里云
  - nginx
categories:
  - Linux服务器
---

## 购买

登录[阿里云-云服务器ECS](https://cn.aliyun.com/product/ecs)选择配置。

## ssh登录

进入控制台-云服务器ECS，选择实例，初次进入需要设置登录密码（更多-密码/秘钥-重置实例密码），然后通过命令行 `ssh -lroot yourIP`(-l 指定登录用户名) 或者 `ssh root@yourIP`进行连接，然后输入密码（后期可以设置 `authorized_keys` 来免密登录）

## 重置系统

有时间你对当前服务器的管理不如意（搞不清楚）时，那么需要重头来玩服务器，进入控制台选中实例-更多-磁盘与镜像-重新初始化磁盘 来完成重置系统，重置系统后登录时需要对上一次进入系统记录的用户信息进行清理，否则会提示

```
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:8hgJ8jpcBr1tm6HS72FpXwMrjba8MQqlqYJQLPB/Qf4.
Please contact your system administrator.
Add correct host key in /Users/jiangwanwei/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /Users/jiangwanwei/.ssh/known_hosts:26
ECDSA host key for xx.xx.xx.xx has changed and you have requested strict checking.
Host key verification failed.
```
原因是因为才重装系统后，再次进行远程连接上，在输入yes后，本机会将远程机器的信息，写到/Users/jiangwanwei/.ssh/known_hosts文件中，所以如果远程重装系统了，本机一定要先清理掉。（删除对应你服务器ip的那条记录）。

## 开启端口

新增端口需要到实例上面开启后才能生效，实例 - 更多 - 网络和安全组 - 安全组配置 - 配置规则 - 添加规则组 ，写入端口范围 例如 8080/8080 授权对象 设置为 0.0.0.0/0 。设置完成后重启服务器。

**需要注意开启端口、或者是修改密码后都需要重启服务器（选中服务-重启）**


## yum介绍

Yum(全称为 Yellow dogUpdater, Modified)是一个在Fedora和RedHat以及CentOS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。yum提供了查找、安装、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。

配置路径为 `/etc/yum.conf`, 常用配置：

```conf
cachedir=/var/cache/yum         #yum下载的RPM包的缓存目录
keepcache=0                        #缓存是否保存，1保存，0不保存。
debuglevel=2                       #调试级别(0-10)，默认为2
logfile=/var/log/yum.log       #yum的日志文件所在的位置
```

常用操作：
### 安装
```bash
$ yum install 全部安装
$ yum install package1 安装指定的安装包package1
$ yum groupinsall group1 安装程序组group1
```

### 更新和升级
```bash
$ yum update 全部更新
$ yum update package1 更新指定程序包package1
$ yum check-update 检查可更新的程序
$ yum upgrade package1 升级指定程序包package1
$ yum groupupdate group1 升级程序组group1
```

### 查找和显示
```bash
$ yum info package1 显示安装包信息package1
$ yum list 显示所有已经安装和可以安装的程序包
$ yum list package1 显示指定程序包安装情况package1
$ yum groupinfo group1 显示程序组group1信息yum search string 根据关键字string查找安装包
```

### 删除程序
```bash
$ yum remove erase package1 删除程序包package1
$ yum groupremove group1 删除程序组group1
$ yum deplist package1 查看程序package1依赖情况
```

### 清除缓存
```bash
$ yum clean packages 清除缓存目录下的软件包
$ yum clean headers 清除缓存目录下的 headers
$ yum clean oldheaders 清除缓存目录下旧的 headers
$ yum clean, yum clean all (= yum clean packages; yum clean oldheaders) 清除缓存目录下的软件包及旧的header
```

## 安装nginx

```bash
$ yum install epel-release # 下载 epel-release
$ yum install nginx # 下载 nginx
$ cd /etc/nginx   #  配置
```

epel-release：EPEL (Extra Packages for Enterprise Linux，企业版Linux的额外软件包) 是Fedora小组维护的一个软件仓库项目，为RHEL/CentOS提供他们默认不提供的软件包。这个源兼容RHEL及像CentOS和Scientific Linux这样的衍生版本。

可以很容易地通过yum命令从EPEL源上获取上万个在CentOS自带源上没有的软件。EPEL提供的软件包大多基于其对应的Fedora软件包，不会与企业版Linux发行版本的软件发生冲突或替换其文件。

## 安装nodejs

```bash
# 下载
$ wget https://npm.taobao.org/mirrors/node/v12.9.1/node-v12.9.1-linux-x64.tar.xz
# 解压
$ tar -xvf node-v12.9.1-linux-x64.tar.xz

# 移动到 /usr

# 建立软连接
$ ln -s /usr/local/share/applications/nodejs/bin/* /usr/local/bin/
```

需要注意的一点  通过npm安装的全局包 如果有出现包命令没有加入到全局环境变量时需要手动 在执行以下软连接 `ln -s /usr/local/share/applications/nodejs/bin/* /usr/local/bin/`，但是每次安装全局包后都要执行，更好的办法是执行一次 `echo -e "export PATH=$(npm prefix -g)/bin:$PATH" >> ~/.bashrc && source ~/.bashrc` 来新增npm全局命令道环境变量PATH中（秩序执行一次）。


## systemctl

systemctl 命令的两大作用，1、控制 systemd 系统  2、管理系统上运行的服务。

常用操作(以nginx为例)：

```bash

# 1.启动nfs服务
$ systemctl start nginx

# 2.设置开机自启动
$ systemctl enable nginx

# 3.停止开机自启动
$ systemctl disable nginx

# 4.查看服务当前状态
$ systemctl status nginx

# 5.重新启动某服务
$ systemctl restart nginx

# 6.查看所有已启动的服务
$ systemctl list -units --type=service

# 开启防火墙22端口
$ iptables -I INPUT -p tcp --dport 22 -j ACCEPT

# 如果仍然有问题，就可能是SELinux导致的
# 关闭SElinux：
# 修改/etc/selinux/config文件中的SELINUX=”” 为 disabled，然后重启

# 彻底关闭防火墙：
$ systemctl status  firewalld.service
$ systemctl stop firewalld.service          
$ systemctl disable firewalld.service

```

至此，服务器nginx 和nodejs都安装好了，可以愉快的玩耍了。。。